<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Effect</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #000000, #4c0080, #0000ff);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
            padding: 1rem;
        }

        .orbitron {
            font-family: 'Orbitron', sans-serif;
        }

        .neon-border {
            border: 2px solid transparent;
            position: relative;
            background-clip: padding-box;
        }

        .neon-border::before {
            content: '';
            position: absolute;
            top: -2px; bottom: -2px; left: -2px; right: -2px;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            z-index: -1;
            border-radius: 12px;
        }
        
        .neon-button {
            transition: all 0.3s ease-in-out;
        }

        .neon-button:hover:not(:disabled) {
            box-shadow: 0 0 10px #00ffff, 0 0 20px #ff00ff, 0 0 30px #00ffff;
            transform: translateY(-2px);
        }

        .neon-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        canvas#image-canvas {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-inter">

    <!-- Header -->
    <header class="flex items-center justify-center p-4">
        <h1 class="text-4xl sm:text-5xl font-bold orbitron text-center bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-fuchsia-600">
            Photo Effect
        </h1>
    </header>

    <main class="container mx-auto flex flex-col lg:flex-row items-center justify-center gap-8 p-4 flex-grow">
        <!-- Upload Section -->
        <section class="w-full lg:w-1/2 p-4 lg:p-8 bg-black bg-opacity-30 rounded-xl neon-border">
            <h2 class="text-2xl font-bold mb-4 orbitron">Unggah Foto</h2>
            <div id="drop-area" class="border-4 border-dashed border-gray-600 rounded-xl p-8 text-center cursor-pointer transition-colors duration-200 hover:border-cyan-400 hover:text-cyan-400">
                <p class="text-xl mb-2">unggah Foto di Sini</p>
                <p class="text-sm text-gray-400 mb-4">üòÅüëá</p>
                <button id="upload-button" class="neon-button bg-purple-600 text-white px-6 py-3 rounded-full font-bold">Pilih Foto dari Perangkat</button>
                <input type="file" id="file-input" class="hidden" accept="image/*">
            </div>
            
            <div id="upload-status" class="mt-4 text-center hidden">
                <p class="text-green-400">berhasil</p>
            </div>
        </section>

        <!-- Preview & Effects Section -->
        <section class="w-full lg:w-1/2 p-4 lg:p-8 bg-black bg-opacity-30 rounded-xl neon-border flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-4 orbitron text-center">DI SINI GAN</h2>
            <div class="relative w-full max-w-sm sm:max-w-md md:max-w-lg mb-6">
                <!-- Canvas untuk pratinjau dan pengeditan -->
                <canvas id="image-canvas" width="600" height="400" class="w-full"></canvas>
            </div>

            <div id="effects-list" class="flex flex-wrap justify-center gap-4 mb-6">
                <button data-filter-class="filter-pink-green" class="neon-button bg-pink-600 px-4 py-2 rounded-lg font-semibold" disabled>Green + Pink</button>
                <button data-filter-class="filter-blue-neon" class="neon-button bg-blue-600 px-4 py-2 rounded-lg font-semibold" disabled>Blue Neon Glow</button>
                <button data-filter-class="filter-purple-aesthetic" class="neon-button bg-purple-600 px-4 py-2 rounded-lg font-semibold" disabled>Purple Aesthetic</button>
                <button data-filter-class="filter-glitch" class="neon-button bg-red-600 px-4 py-2 rounded-lg font-semibold" disabled>Glitch Effect</button>
                <button data-filter-class="filter-gradient-pop" class="neon-button bg-yellow-600 px-4 py-2 rounded-lg font-semibold" disabled>Gradient Pop</button>
                <button data-filter-class="none" class="neon-button bg-gray-600 px-4 py-2 rounded-lg font-semibold" disabled>Reset</button>
            </div>

            <button id="download-button" class="neon-button bg-cyan-600 text-white px-8 py-4 rounded-full font-bold text-lg mt-4 w-full sm:w-auto" disabled>
                Unduh Gambar
            </button>
        </section>
    </main>

    <!-- Footer -->
    <footer class="text-center text-sm text-gray-500 mt-auto p-4">
        MADE BY D'BAGINDAS
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const uploadButton = document.getElementById('upload-button');
            const imageCanvas = document.getElementById('image-canvas');
            const ctx = imageCanvas.getContext('2d');
            const effectsList = document.getElementById('effects-list');
            const downloadButton = document.getElementById('download-button');
            const uploadStatus = document.getElementById('upload-status');
            const effectButtons = document.querySelectorAll('#effects-list button');

            let uploadedImage = null;

            // Set placeholder image on canvas
            const placeholderImage = new Image();
            placeholderImage.onload = () => {
                imageCanvas.width = placeholderImage.width;
                imageCanvas.height = placeholderImage.height;
                ctx.drawImage(placeholderImage, 0, 0);
            };
            placeholderImage.src = 'https://placehold.co/600x400/000000/FFFFFF?text=Unggah+Foto+Di+Sini';

            // Function to enable all buttons
            function enableButtons() {
                effectButtons.forEach(button => button.disabled = false);
                downloadButton.disabled = false;
            }

            // Prevent default behavior for drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => dropArea.classList.add('border-cyan-400', 'text-cyan-400'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => dropArea.classList.remove('border-cyan-400', 'text-cyan-400'), false);
            });

            dropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            uploadButton.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

            function handleFiles(files) {
                if (files.length === 0) return;
                
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        uploadedImage = new Image();
                        uploadedImage.onload = () => {
                            // Resize canvas to match the image dimensions
                            imageCanvas.width = uploadedImage.width;
                            imageCanvas.height = uploadedImage.height;
                            
                            // Draw the image on the canvas
                            ctx.filter = 'none';
                            ctx.drawImage(uploadedImage, 0, 0);
                            
                            // Enable buttons after image is loaded
                            enableButtons();
                            uploadStatus.classList.remove('hidden');
                        };
                        uploadedImage.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }

            // Function untuk mengaplikasikan filter dengan manipulasi piksel
            function applyPixelFilter(filterType) {
                if (!uploadedImage) return;

                // Gambar ulang foto asli ke kanvas
                ctx.filter = 'none';
                ctx.drawImage(uploadedImage, 0, 0, uploadedImage.width, uploadedImage.height);
                
                // Dapatkan data piksel dari kanvas
                const imageData = ctx.getImageData(0, 0, imageCanvas.width, imageCanvas.height);
                const data = imageData.data;

                // Loop melalui setiap piksel
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    const alpha = data[i + 3];

                    // Hitung nilai grayscale untuk menentukan kecerahan piksel
                    const grayscale = (r + g + b) / 3;

                    // Terapkan efek berdasarkan tipe filter
                    if (filterType === 'filter-pink-green') {
                        // Menggunakan interpolasi yang lebih lembut untuk duotone
                        const shadowColor = { r: 20, g: 80, b: 20 }; // Hijau yang lebih gelap
                        const highlightColor = { r: 200, g: 80, b: 200 }; // Pink yang lebih lembut
                        
                        const factor = grayscale / 255;
                        data[i] = Math.round(shadowColor.r + (highlightColor.r - shadowColor.r) * factor);
                        data[i + 1] = Math.round(shadowColor.g + (highlightColor.g - shadowColor.g) * factor);
                        data[i + 2] = Math.round(shadowColor.b + (highlightColor.b - shadowColor.b) * factor);

                    } else if (filterType === 'filter-blue-neon') {
                        // Mengatur nilai RGB untuk efek neon yang lebih halus
                        data[i] = Math.round(grayscale * 0.6);
                        data[i + 1] = Math.round(grayscale * 1.0);
                        data[i + 2] = Math.round(grayscale * 1.2);

                    } else if (filterType === 'filter-purple-aesthetic') {
                         // Mengatur nilai RGB untuk efek ungu yang tidak terlalu terang
                        data[i] = Math.round(grayscale * 1.1);
                        data[i + 1] = Math.round(grayscale * 0.6);
                        data[i + 2] = Math.round(grayscale * 1.1);

                    } else if (filterType === 'filter-glitch') {
                        // Efek glitch sederhana dengan memanipulasi saluran warna
                        data[i] = g;
                        data[i + 1] = b;
                        data[i + 2] = r;

                    } else if (filterType === 'filter-gradient-pop') {
                        const orange = { r: 200, g: 120, b: 0 };
                        const yellow = { r: 255, g: 255, b: 0 };
                        
                        const factor = grayscale / 255;
                        data[i] = Math.round(orange.r + (yellow.r - orange.r) * factor);
                        data[i + 1] = Math.round(orange.g + (yellow.g - orange.g) * factor);
                        data[i + 2] = Math.round(orange.b + (yellow.b - orange.b) * factor);
                    }
                }

                // Tulis data piksel yang sudah diubah kembali ke kanvas
                ctx.putImageData(imageData, 0, 0);
            }

            // Apply effects to canvas
            effectsList.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && !e.target.disabled) {
                    const filterClass = e.target.dataset.filterClass;
                    if (filterClass === 'none') {
                        // Menggambar ulang gambar asli
                        ctx.filter = 'none';
                        if (uploadedImage) {
                            ctx.drawImage(uploadedImage, 0, 0, uploadedImage.width, uploadedImage.height);
                        }
                    } else {
                        applyPixelFilter(filterClass);
                    }
                }
            });

            // Download image from canvas
            downloadButton.addEventListener('click', () => {
                if (!uploadedImage || downloadButton.disabled) {
                    return;
                }
                
                const link = document.createElement('a');
                link.download = 'photo-effect-lab-result.png';
                link.href = imageCanvas.toDataURL('image/png');
                link.click();
            });
        });
    </script>
</body>
</html>
